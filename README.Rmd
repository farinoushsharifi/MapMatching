---
title: "TransGPS Package"
author: "Farinoush Sharifi"

date: "May 2019"
output: 
  github_document:
        toc: true
        toc_depth: 4
  
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,tidy='formatR', tidy.opts=list(width.cutoff = 70))
```

## TransGPS: Toward a better analysis of GPS data

This package is developed to ease the tedious procedure of GPS data cleaning and map matching. The functions provided here focus from the very basic regularization and coordinates conversion of the GPS data toward creating bounding boxes and accessing the well-known [OpenStreetMap(OSM)](https://www.openstreetmap.org) data for the purpose of map matching. 

Creating bounding boxes allows the users to access OSM data without any challenges of developing a data server. This package also provides an interactive platform for the users to find the desired bounding boxes on the map. Finally, the user can find the best link match for each GPS coordinate.

### Installation

```{r install, tidy='formatR'}
##devtools::install_github("farinoushsharifi/TransGPS")
```

### Usage

```{r attach, echo=T, results='hide', message=F, warning=F, tidy='formatR'}
library(TransGPS)

### Load Sample Data
data("SampleTransGPS")
```

The first 10 rows of the data can be seen here:

```{r head data, echo=FALSE}
head(as.data.frame(SampleTransGPS),10)
```

#### 1. Coordinates Conversion to New CRS

Conversion of the GPS coordinates into a new CRS is the base to initiate any GPS analysis studies. `convert_crs` takes the initial latitude and longitude of a list of points and convert to any new CRS. The default value for the final projection is `"+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0"`, which the CRS corresponding to OSM data (and the CRS for the `SampleTransGPS` data).

```{r conversion, tidy='formatR', tidy.opts=list(width.cutoff = 70),cache=T}
#define the conversion function inputs 
LatList1 <- SampleTransGPS$Latitude  
LongList1 <- SampleTransGPS$Longitude
timeseq1 <- SampleTransGPS$First.Time
timeseq1 <-  as.POSIXct(timeseq1, format = "%I:%M:%S %p")

InitProj <- "+proj=longlat +ellps=WGS84 
+datum=WGS84 +no_defs +towgs84=0,0,0"
NextProj <- "+init=epsg:28992"

#convert from the initial CRS to a new one
convlist <- convert_crs(LatList1,LongList1,InitProj,NextProj)
```

The first 10 rows of the converted data can be seen here:

```{r head convlist, echo=FALSE }
head(data.frame(convlist$Latitude,convlist$Longitude),10)
```

#### 2. Coordinates Interpolation

Intepolation of coordinates over a desired time sequence is so useful in case of irregular time sequence or better visualization of data on contour maps. Function `interpolate_coords` takes the lists of latitudes and longitudes over an irregular time sequence and interpolates coordinates.
```{r interp data, tidy='formatR', tidy.opts=list(width.cutoff = 70),cache=TRUE}
#taking a sample of data for an irregular time sequence
rowIDs <- sample(1:nrow(SampleTransGPS),200)
SampleTransGPS_ir <- SampleTransGPS[rowIDs,]
```

There is no need to sort the data befpre using the `interpolation_coords` function. The first 10 rows can be seen here:

```{r head irreg, echo=FALSE }
head(SampleTransGPS_ir,10)
```

This data can be interpolated using function `interpolate_coord`
```{r interp func, tidy='formatR', tidy.opts=list(width.cutoff = 70),cache=T}
#define the interpolation function inputs
LatList2 <- SampleTransGPS_ir$Latitude
LongList2 <- SampleTransGPS_ir$Longitude
timeseq2 <- SampleTransGPS_ir$First.Time
timeseq2 <-  as.POSIXct(timeseq2, format = "%I:%M:%S %p")
timeint <- 2 ###2 seconds

interp_data <- interpolate_coords(LatList2,LongList2,timeseq2,timeint)

```

#### Generate Bounding Boxes

```{r bbox, echo=FALSE}
#Example 2:

offLong=0.001
offLat=0.002
```

#### Iteration Over Bounding Boxes

```{r pressure3, echo=FALSE}
plot(pressure)
```

#### Matching The OSM Link IDs to GPS Coordinates

```{r pressure4, echo=FALSE}
plot(pressure)
```

### Details

For more information on TransGPS Package, please access the package vignettes
```{r pressure5, echo=FALSE}
plot(pressure)
```

